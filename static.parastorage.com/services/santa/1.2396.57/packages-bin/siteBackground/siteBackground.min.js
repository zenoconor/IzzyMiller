"use strict";define("siteBackground",["lodash","santaProps","core","utils","mediaCommon","backgroundCommon"],function(e,i,t,r,o,a){function s(e){return e.isExperimentOpen("sv_mobileBgFixed")?e.isMobileView?"viewport"!==e.compData.mediaSizing:!e.fixedSiteBackground:e.isMobileView||!e.fixedSiteBackground}function n(i,t){var r=e.get(i,"scrollType"),o=e.get(i,["mediaRef","type"]);return(!("Image"===o||"WixVideo"===o)||s(t)||t.isAndroidOldBrowser)&&(r="scroll"),r}function p(i,t){var r="absolute";return"WixVideo"!==e.get(i,["mediaRef","type"])&&"fixed"!==t&&"parallax"!==t||(r="fixed"),r}function c(e,i,t){var o=p(i,n(i,e)),a={top:0,height:f,width:y,backgroundColor:r.colorParser.getColor(e.colorsMap,i.color),display:t?"none":"",position:o};return e.isMobileView&&"fixed"===o&&(a.willChange="transform"),a}function d(e){var i=f;return"parallax"===e&&(i=P),i}function l(e){var i=k;return"parallax"===e&&(i=b),i}function u(e,i){var t=i.mediaRef,r=n(i,e),o={position:"absolute",top:l(r),height:d(r),width:y,opacity:t&&t.opacity};return e.isMobileView&&"fixed"===r&&(o.willChange="transform"),o}function g(i,t){var r=i.background,o=t.background,a=r.mediaRef||{},s=o.mediaRef||{},n=!r.mediaRef&&!o.mediaRef,p=n||a.type===s.type,c=i.mediaSizing===t.mediaSizing,d=["mediaRef","imageOverlay"],l=["type","alignType","fittingType","scrollType","colorOverlay","colorOverlayOpacity","color","videoId","uri","opacity"];return"WixVideo"===a.type&&p?l=e.without(l,"color"):n&&(l=["color"]),p&&c&&h(r,o,d,l)}function h(i,t,r,o){var a=e.every(o,function(e){return(i&&i[e])===(t&&t[e])});return a=a&&e.every(r,function(e){return!i||h(i[e],t[e],r,o)})}function m(e,i){var t=i.colorOverlay?r.colorParser.getColor(e.colorsMap,i.colorOverlay,i.colorOverlayOpacity):null,o=v(e,i.imageOverlay);return{position:"absolute",top:0,width:y,height:f,backgroundImage:o,backgroundColor:t}}function v(e,i){return i?"url("+r.urlUtils.joinURL(e.staticMediaUrl,i.uri)+")":null}var y="100%",f="100%",k=0,P="120%",b=0,B=r.mediaConsts;return{displayName:"SiteBackground",mixins:[o.mediaLogicMixins.fill,t.compMixins.skinBasedComp,t.compMixins.animationsMixin,a.mixins.backgroundDetectionMixin],propTypes:e.defaults({id:i.Types.Component.id,compData:i.Types.Media.SiteBackground.data,actionsAspect:i.Types.SiteAspects.actionsAspect.isRequired,currentUrlPageId:i.Types.Component.currentUrlPageId,isMobileView:i.Types.isMobileView.isRequired,isTouchDevice:i.Types.Device.isTouchDevice,isAndroidOldBrowser:i.Types.Browser.isAndroidOldBrowser,colorsMap:i.Types.Theme.colorsMap,staticMediaUrl:i.Types.ServiceTopology.staticMediaUrl,componentViewMode:i.Types.RenderFlags.componentViewMode.isRequired,fixedSiteBackground:i.Types.BrowserFlags.fixedSiteBackground.isRequired,mediaQuality:i.Types.Media.SiteBackground.mediaQuality,isExperimentOpen:i.Types.isExperimentOpen},i.santaTypesUtils.getSantaTypesByDefinition(a.components.html5Video)),statics:{useSantaTypes:!0,behaviors:o.mediaBehaviors.fill},previousScroll:null,getInitialState:function(){return this.size={},{resetAttachment:!1,hidePrevious:!1}},callForBackgroundChange:function(i){var t={onComplete:function(){this.isPageChanged()&&(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,resetAttachment:!1,hidePrevious:!0}))}.bind(this)};this.props.actionsAspect.registerNextBGPageTransition(this,"previous","current",t),this.setState({previousPageBackground:i,resetAttachment:!0,hidePrevious:!1,currentVisiblePageId:null})},componentWillReceiveProps:function(i){if(this.props.currentUrlPageId!==i.currentUrlPageId){var t=this.props.compData;g(t,i.compData)?(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,currentVisiblePageId:this.state.currentVisiblePageId||this.props.compData.background.id})):this.callForBackgroundChange(t.background)}},handleParallaxBehavior:function(e){var i=n(e,this.props);("parallax"===this.previousScroll||"parallax"===i)&&(this.previousScroll=i,"parallax"===i?this.props.actionsAspect.registerBehaviors("currentImage","siteBackground",[{action:"bgScrub",name:"SiteBackgroundParallax",duration:1,delay:0}]):this.props.actionsAspect.unRegisterBehaviors("currentImage",[{action:"bgScrub",name:"SiteBackgroundParallax",duration:1,delay:0}]))},getClasses:function(){return""},isPageChanged:function(){return this.props.compData.background.id!==e.get(this.state,["previousPageBackground","id"])},createVideoComponent:function(i,t){var r={comp:"wysiwyg.viewer.components.background.html5Video",skin:"skins.viewer.bgVideo.html5VideoSkin",style:"bgVideo"},o=i.mediaRef,a="current"===t;return"WixVideo"!==e.get(o,"type")?(a&&this.setMediaAPI(null),null):this.createChildComponent(o,r.comp,{skin:r.skin,styleId:r.style},{id:this.props.id+t+"Video",key:"vid_"+o.videoId,notifyMediaState:this.onMediaChange,setMediaAPI:a?this.setMediaAPI:e.noop,mediaQuality:this.props.mediaQuality,className:"siteBackground"+t+"Video",compProp:e.pick(o,B.playback.SUPPORTED_MEDIA_ATTRIBUTES)})},getSkinProperties:function(){var i=this.state.currentVisiblePageId||this.props.compData.background.id,t=e.get(this.state.previousPageBackground,"id","noPrev");t=t===i?"noPrev":t;var r,o,a,s,p=null,d=!this.props.isTouchDevice,l=this.props.id,g=this.props.compData.background,h=u(this.props,g);s={id:l+"_currentImage_"+i,style:h,"data-type":B.balataConsts.BG_IMAGE,"data-height":h.height},d&&((o=this.createVideoComponent(g,"current"))||this.setMediaAPI(null)),this.state.previousPageBackground&&(a={id:l+"_previousImage_"+t,style:(p=this.state.previousPageBackground)?u(this.props,p):{}},d&&(r=this.createVideoComponent(p,"previous"))),this.handleParallaxBehavior(g);var v=c(this.props,g,!1);return{"":{id:l,className:this.getClasses()},current:{key:i+n(g,this.props)+this.props.componentViewMode,id:l+"_current_"+i,style:v,"data-position":v.position},currentImage:s,currentVideo:o,currentOverlay:{id:l+"_currentOverlay_"+i,style:m(this.props,g)},previous:{key:t+n(p,this.props)+this.props.componentViewMode,id:l+"_previous_"+t,style:p?c(this.props,p,this.state.hidePrevious):{}},previousImage:a,previousVideo:r,previousOverlay:{id:l+"_previousOverlay_"+t,style:p?m(this.props,p):{}}}}}});
//# sourceMappingURL=siteBackground.min.js.map