"use strict";define("matrixGallery",["lodash","skins","core","santaProps","utils","coreUtils","galleriesCommon","displayer","reactDOM","zepto"],function(e,t,i,s,o,r,a,p,n,l){function h(e,t,i){return i<=e*t?"fullView":"hiddenChildren"}function m(e){return Math.max(d.MIN_GALLERY_HEIGHT,e)}function g(t,i){if(t&&i&&t.skin===i.skin){var s=e.pick(t.style.properties,w),o=e.pick(i.style.properties,w);return!e.isEqual(s,o)}return!1}var c=i.compMixins,y=r.matrix.calculations,u=r.matrix.scalingCalculations,d=a.utils.galleriesHelperFunctions,f=o.galleriesCommonLayout,w=["topPadding","imgHeightDiff"],D={displayName:"MatrixGallery",propTypes:e.assign({shouldResetGalleryToOriginalState:s.Types.RenderFlags.shouldResetGalleryToOriginalState.isRequired,compProp:s.Types.Component.compProp.isRequired,compData:s.Types.Component.compData.isRequired,style:s.Types.Component.style.isRequired,skin:s.Types.Component.skin.isRequired,compTheme:s.Types.Component.theme,currentUrlPageId:s.Types.Component.currentUrlPageId.isRequired,isMobileView:s.Types.isMobileView,isMobileDevice:s.Types.Device.isMobileDevice,isTabletDevice:s.Types.Device.isTabletDevice,compActions:s.Types.Component.compActions.isRequired},s.santaTypesUtils.getSantaTypesByDefinition(p)),statics:{useSantaTypes:!0},mixins:[c.skinBasedComp,c.skinInfo],getInitialState:function(){return this.getInitStateAndResetInstance(this.props)},getInitStateAndResetInstance:function(e){var t=e||this.props;this.shouldResetGalleryToOriginalState=t.shouldResetGalleryToOriginalState;var i=y.getAvailableRowsNumber(t.compProp.maxRows,t.compProp.numCols,t.compData.items.length),s=t.isMobileView?"mobileView":"desktopView";return this.showMoreClicked=!1,this.galleryHeight=m(t.style.height),this.itemHeight=y.getItemHeight(t.compProp.margin,this.galleryHeight,i,d.getSkinHeightDiff(t.skin)),{numberOfRows:i,$mobile:t.isMobileDevice||t.isTabletDevice?"mobile":"notMobile",$displayDevice:s,$state:h(i,t.compProp.numCols,t.compData.items.length)}},createDisplayer:function(e,i,s,o){var r=this.getDisplayerSkin(),a=t.skins[this.props.skin],p=a.exports&&a.exports.bottomGap||0,n=this.getParams(w,r),l=d.getDisplayerHeightDiff(t.skins[r],n,this.state.$displayDevice),h=d.getDisplayerWidthDiff(t.skins[r],this.state.$displayDevice),m=u.getSizeAfterScaling({itemHeight:o,itemWidth:s,displayerData:e,imageMode:this.props.compProp.imageMode,widthDiff:h,heightDiff:l,bottomGap:p}),g=y.getItemPosition(i,s,o,this.props.compProp.margin,this.props.compProp.numCols);return this.createChildComponent(e,"wysiwyg.viewer.components.Displayer","imageItem",{key:e.id,ref:e.id,id:this.props.id+e.id,currentUrlPageId:this.props.currentUrlPageId,galleryId:this.props.id,galleryDataId:this.props.compData.id,imageWrapperSize:m.imageWrapperSize,imageIndex:i,heightDiff:l,widthDiff:h,bottomGap:p,style:{width:m.displayerSize.width,height:m.displayerSize.height,position:"absolute",left:g.left,top:g.top}})},createDisplayers:function(){var t=e.take(this.props.compData.items,this.props.compProp.numCols*this.state.numberOfRows),i=y.getItemWidth(this.props.compProp.margin,this.props.compProp.numCols,this.props.style.width,d.getSkinWidthDiff(this.props.skin)),s=this.itemHeight||y.getItemHeight(this.props.compProp.margin,this.galleryHeight,this.state.numberOfRows,d.getSkinHeightDiff(this.props.skin));return e.map(t,function(e,t){return this.createDisplayer(e,t,i,s)}.bind(this))},componentWillReceiveProps:function(t){var i=y.getAvailableRowsNumber(t.compProp.maxRows,t.compProp.numCols,t.compData.items.length),s={},o=!1;if(this.props.compProp.maxRows===t.compProp.maxRows&&this.props.compProp.numCols===t.compProp.numCols&&this.props.compData.items.length===t.compData.items.length||(o=!0,s.numberOfRows=i,this.galleryHeight=m(d.getGalleryHeight(this.state.numberOfRows,i,this.props.compProp.margin,this.props.skin,this.galleryHeight)),s.$state=h(i,t.compProp.numCols,t.compData.items.length)),this.props.style.height!==t.style.height&&(o=!0,this.galleryHeight=m(t.style.height)),this.shouldResetGalleryToOriginalState!==t.shouldResetGalleryToOriginalState&&(this.shouldResetGalleryToOriginalState&&this.resetGalleryState&&this.resetGalleryState(t),this.shouldResetGalleryToOriginalState=t.shouldResetGalleryToOriginalState),o||g(this.props.compTheme,t.compTheme)){this.itemHeight=y.getItemHeight(t.compProp.margin,this.galleryHeight,i,d.getSkinHeightDiff(this.props.skin));var r=d.getSkinHeightDiff(this.props.skin),a=s.numberOfRows||this.state.numberOfRows;this.galleryHeight=a*this.itemHeight+(a-1)*this.props.compProp.margin+r}e.isEmpty(s)||this.setState(s)},getSkinProperties:function(){var e={showMore:{children:this.props.compProp.showMoreLabel,onClick:this.showMoreRows},itemsContainer:{children:this.createDisplayers(),style:{height:this.galleryHeight},onKeyDown:this.onKeyDown},"":{"data-height-diff":d.getSkinHeightDiff(this.props.skin),"data-width-diff":d.getSkinWidthDiff(this.props.skin),"data-presented-row":this.state.numberOfRows,style:{height:this.galleryHeight}}};return(this.showMoreClicked||"fullView"===this.state.$state)&&f.updateSkinPropsForFlexibleHeightGallery(e,this.galleryHeight),e},showMoreRows:function(){var e=y.getAvailableRowsNumber(this.state.numberOfRows+this.props.compProp.incRows,this.props.compProp.numCols,this.props.compData.items.length);this.showMoreClicked=!0,this.galleryHeight=m(d.getGalleryHeight(this.state.numberOfRows,e,this.props.compProp.margin,this.props.skin,this.galleryHeight)),this.registerReLayout(),this.setState({numberOfRows:e,$state:h(e,this.props.compProp.numCols,this.props.compData.items.length)})},getDisplayerSkin:function(){return this.getSkinExports().imageItem.skin},navigateGalleryFocus:function(e,t){var i,s=o.accessibility.getTabbaleElements(n.findDOMNode(this)),r=s.indexOf(e),a=Math.ceil(s.length/this.state.numberOfRows);"ArrowDown"===t&&(i=r+a)>=s.length&&(i%=s.length),"ArrowUp"===t&&(i=r-a)<0&&(i=s.length-Math.abs(i)),"ArrowRight"===t&&(i=r+1)>=s.length&&(i=0),"ArrowLeft"===t&&(i=r-1)<0&&(i=s.length-1);var p=s[i];p&&l(p).focus()},onKeyDown:function(t){var i=["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"];e.includes(i,t.key)&&(t.stopPropagation(),t.preventDefault(),this.navigateGalleryFocus(t.target,t.key))}};return i.compRegistrar.register("wysiwyg.viewer.components.MatrixGallery",D,!0),D});
//# sourceMappingURL=matrixGallery.min.js.map